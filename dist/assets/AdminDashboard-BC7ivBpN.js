import{j as e}from"./ui-DVmofzuT.js";import{r as l}from"./vendor-Bh044VG2.js";import{u as be,s as d,L as G}from"./index-BMdVCYPh.js";import{E as fe}from"./editor-Fw73Cy45.js";import{g as ye}from"./cloudinaryConfig-Dce98kpw.js";import"./three-DA2LJXh8.js";function Se(){const[v,j]=l.useState([]),[a,w]=l.useState(null),[E,z]=l.useState(null),[B,A]=l.useState(""),[p,g]=l.useState([]),[u,b]=l.useState(null),[J,P]=l.useState(!1),[N,k]=l.useState(""),[C,U]=l.useState(""),[Q,S]=l.useState(!1),[X,M]=l.useState(!1),[T,W]=l.useState([]),[L,H]=l.useState(null),[Y,$]=l.useState(!1),[q,O]=l.useState("all"),[ee,V]=l.useState(!0),[i,R]=l.useState(""),[f,F]=l.useState("users"),[D,_]=l.useState(!1),[h,I]=l.useState("all"),[y,K]=l.useState("user"),{user:ve}=be();l.useEffect(()=>{te(),re(),se()},[]);async function te(){try{const{data:t,error:r}=await d.from("profiles").select("*").order("created_at",{ascending:!1});if(r)throw r;j(t||[]),V(!1)}catch(t){console.error("Error fetching users:",t),V(!1)}}async function re(){try{const{data:t,error:r}=await d.from("posts").select("*").order("created_at",{ascending:!1});if(r)throw r;const s=[...new Set((t==null?void 0:t.map(n=>n.author_id))||[])],{data:o,error:c}=await d.from("profiles").select("*").in("id",s);if(c)throw c;const m=new Map(o==null?void 0:o.map(n=>[n.id,n])),x=(t==null?void 0:t.map(n=>({...n,author:m.get(n.author_id)||{username:"Unknown",full_name:"Unknown User"}})))||[];g(x)}catch(t){console.error("Error fetching posts:",t)}}async function se(){try{const{data:t,error:r}=await d.from("comments").select("*").order("created_at",{ascending:!1});if(r)throw r;const s=[...new Set((t==null?void 0:t.map(n=>n.user_id))||[])],{data:o,error:c}=await d.from("profiles").select("*").in("id",s);if(c)throw c;const m=new Map(o==null?void 0:o.map(n=>[n.id,n])),x=(t==null?void 0:t.map(n=>({...n,user:m.get(n.user_id)||{username:"Unknown",full_name:"Unknown User"}})))||[];W(x)}catch(t){console.error("Error fetching comments:",t)}}const ae=t=>{w(t),A(t.avatar_url||""),K(t.role||"user")},oe=t=>{b(t),k(t.title),U(t.content),P(!0)},le=t=>{if(t.target.files&&t.target.files[0]){const r=t.target.files[0];z(r),A(URL.createObjectURL(r))}};async function ne(t,r){var s;try{const o=String(Math.round(new Date().getTime()/1e3)),c=await ye(o),m=new FormData;m.append("file",t),m.append("timestamp",o),m.append("api_key","752847587235562"),m.append("signature",c);const x=await fetch(`https://api.cloudinary.com/v1_1/dckv73izl/${r}/upload`,{method:"POST",body:m});if(!x.ok){const ge=await x.json();throw new Error(`Cloudinary upload failed: ${((s=ge.error)==null?void 0:s.message)||"Unknown error"}`)}return(await x.json()).secure_url}catch(o){throw console.error("Error uploading to Cloudinary:",o),o}}const ie=async()=>{if(!(!a||!E)){_(!0);try{const t=await ne(E,"image"),{error:r}=await d.from("profiles").update({avatar_url:t}).eq("id",a.id);if(r)throw r;const s={...a,avatar_url:t};j(v.map(c=>c.id===a.id?s:c)),w(s),A(t),z(null);const o=document.getElementById("avatar-upload");o&&(o.value="")}catch(t){console.error("Error updating avatar:",t)}finally{_(!1)}}},ce=async()=>{if(!(!a||!y))try{const{error:t}=await d.from("profiles").update({role:y}).eq("id",a.id);if(t)throw t;j(v.map(r=>r.id===a.id?{...r,role:y}:r)),w({...a,role:y})}catch(t){console.error("Error updating user role:",t)}},de=async()=>{if(a)try{const{error:t}=await d.from("posts").delete().eq("author_id",a.id);if(t)throw t;const{error:r}=await d.from("profiles").delete().eq("id",a.id);if(r)throw r;j(v.filter(s=>s.id!==a.id)),g(p.filter(s=>s.author_id!==a.id)),w(null),M(!1)}catch(t){console.error("Error deleting user:",t)}},me=async()=>{if(!(!u||!N||!C)){_(!0);try{const{error:t}=await d.from("posts").update({title:N,content:C}).eq("id",u.id);if(t)throw t;g(p.map(r=>r.id===u.id?{...r,title:N,content:C}:r)),P(!1),b(null),k(""),U("")}catch(t){console.error("Error updating post:",t)}finally{_(!1)}}},ue=async()=>{if(u)try{const{error:t}=await d.from("posts").delete().eq("id",u.id);if(t)throw t;g(p.filter(r=>r.id!==u.id)),b(null),S(!1)}catch(t){console.error("Error deleting post:",t)}},he=async()=>{if(L)try{const{error:t}=await d.from("comments").delete().eq("id",L.id);if(t)throw t;W(T.filter(r=>r.id!==L.id)),H(null),$(!1)}catch(t){console.error("Error deleting comment:",t)}},xe=async t=>{try{const{error:r}=await d.from("posts").update({published:!t.published}).eq("id",t.id);if(r)throw r;g(p.map(s=>s.id===t.id?{...s,published:!s.published}:s))}catch(r){console.error("Error toggling publish status:",r)}},pe=v.filter(t=>{var r,s,o;return((r=t.username)==null?void 0:r.toLowerCase().includes(i.toLowerCase()))||((s=t.full_name)==null?void 0:s.toLowerCase().includes(i.toLowerCase()))||((o=t.email)==null?void 0:o.toLowerCase().includes(i.toLowerCase()))}),Z=p.filter(t=>{var s,o,c,m;const r=t.title.toLowerCase().includes(i.toLowerCase())||((o=(s=t.author)==null?void 0:s.username)==null?void 0:o.toLowerCase().includes(i.toLowerCase()))||((m=(c=t.author)==null?void 0:c.full_name)==null?void 0:m.toLowerCase().includes(i.toLowerCase()));return h==="published"?r&&t.published:h==="draft"?r&&!t.published:r});return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex border-b border-border mb-6",children:[e.jsx("button",{onClick:()=>F("users"),className:`mr-4 py-2 px-4 focus:outline-none ${f==="users"?"border-b-2 border-primary text-primary font-medium":"text-text-secondary hover:text-text-primary"}`,children:"Manage Users"}),e.jsx("button",{onClick:()=>F("posts"),className:`mr-4 py-2 px-4 focus:outline-none ${f==="posts"?"border-b-2 border-primary text-primary font-medium":"text-text-secondary hover:text-text-primary"}`,children:"Manage Posts"}),e.jsx("button",{onClick:()=>F("comments"),className:`mr-4 py-2 px-4 focus:outline-none ${f==="comments"?"border-b-2 border-primary text-primary font-medium":"text-text-secondary hover:text-text-primary"}`,children:"Manage Comments"})]}),ee?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(G,{size:"lg"})}):f==="users"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-background-secondary rounded-lg p-6 shadow-lg",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full px-4 py-2 rounded-lg border border-border focus:outline-none focus:ring-2 focus:ring-primary",value:i,onChange:t=>R(t.target.value)})}),e.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:pe.map(t=>e.jsx("div",{className:`p-4 rounded-lg cursor-pointer transition-colors ${(a==null?void 0:a.id)===t.id?"bg-primary text-white":"bg-background-tertiary hover:bg-background-hover"}`,onClick:()=>ae(t),children:e.jsxs("div",{className:"flex items-center space-x-4",children:[t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:t.username||"User avatar",className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary flex items-center justify-center text-white font-semibold",children:(t.full_name||t.username||"U").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:t.full_name||t.username}),e.jsx("p",{className:"text-sm opacity-75",children:t.email}),e.jsxs("p",{className:"text-sm opacity-75",children:["Role: ",t.role||"user"]})]})]})},t.id))})]}),e.jsx("div",{className:"bg-background-secondary rounded-lg p-6 shadow-lg",children:a?e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6",children:["Edit User: ",a.username]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Avatar"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[B?e.jsx("img",{src:B,alt:"Avatar preview",className:"w-24 h-24 rounded-full object-cover"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-primary flex items-center justify-center text-white text-2xl font-semibold",children:(a.full_name||a.username||"U").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:le,className:"hidden",id:"avatar-upload"}),e.jsx("label",{htmlFor:"avatar-upload",className:"px-4 py-2 bg-primary text-white rounded-lg cursor-pointer hover:bg-primary-hover transition-colors",children:"Choose Image"})]})]})]}),e.jsx("button",{onClick:ie,disabled:!E||D,className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:D?"Updating...":"Update Avatar"}),e.jsxs("div",{className:"border-t border-border pt-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"User Role"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("select",{value:y,onChange:t=>K(t.target.value),className:"w-40 px-4 py-2 rounded-lg border border-gray-300 bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary",style:{WebkitAppearance:"menulist",appearance:"menulist"},children:[e.jsx("option",{value:"user",style:{backgroundColor:"white",color:"black",padding:"8px"},children:"User"}),e.jsx("option",{value:"admin",style:{backgroundColor:"white",color:"black",padding:"8px"},children:"Admin"})]}),e.jsx("button",{onClick:ce,className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors",children:"Update Role"})]})]}),e.jsxs("div",{className:"border-t border-border pt-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Danger Zone"}),e.jsx("button",{onClick:()=>M(!0),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:"Delete User Account"})]})]})]}):e.jsx("div",{className:"text-center text-text-secondary",children:"Select a user to edit their details"})})]}):f==="posts"?e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",placeholder:"Search posts...",className:"px-4 py-2 rounded-lg border border-border focus:outline-none focus:ring-2 focus:ring-primary",value:i,onChange:t=>R(t.target.value)}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>I("all"),className:`px-4 py-2 rounded-l-lg ${h==="all"?"bg-primary text-white":"bg-background-secondary hover:bg-background-hover"}`,children:"All"}),e.jsx("button",{onClick:()=>I("published"),className:`px-4 py-2 ${h==="published"?"bg-primary text-white":"bg-background-secondary hover:bg-background-hover"}`,children:"Published"}),e.jsx("button",{onClick:()=>I("draft"),className:`px-4 py-2 rounded-r-lg ${h==="draft"?"bg-primary text-white":"bg-background-secondary hover:bg-background-hover"}`,children:"Drafts"})]})]})}),J&&u?e.jsxs("div",{className:"bg-background-secondary rounded-lg p-6 shadow-lg mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Edit Post"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Title"}),e.jsx("input",{type:"text",value:N,onChange:t=>k(t.target.value),className:"w-full px-4 py-2 rounded-lg border border-border focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Content"}),e.jsx(fe,{apiKey:"wqdsjyw1ljs9pgmvqrz0yra3xquexocn79m345lw5yv0uk5x",init:{height:400,menubar:!1,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","code","help","wordcount"],toolbar:"undo redo | blocks | bold italic forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family: -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif; font-size: 14px; }"},value:C,onEditorChange:U})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{P(!1),b(null),k(""),U("")},className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:me,disabled:D,className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover disabled:opacity-50",children:D?e.jsx(G,{size:"sm"}):"Update Post"}),e.jsx("button",{onClick:()=>S(!0),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete Post"})]})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Z.map(t=>{var r,s;return e.jsxs("div",{className:"bg-background-secondary rounded-lg shadow-lg overflow-hidden",children:[t.featured_image&&e.jsx("img",{src:t.featured_image,alt:t.title,className:"w-full h-48 object-cover"}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:t.title}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:`px-2 py-1 rounded text-sm ${t.published?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100"}`,children:t.published?"Published":"Draft"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>oe(t),className:"text-text-secondary hover:text-primary",title:"Edit",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>xe(t),className:"text-text-secondary hover:text-primary",title:t.published?"Unpublish":"Publish",children:t.published?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})}):e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 15l7-7 7 7"})})}),e.jsx("button",{onClick:()=>{b(t),S(!0)},className:"text-text-secondary hover:text-red-500",title:"Delete",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("p",{className:"text-sm text-text-secondary mb-3",children:["By ",((r=t.author)==null?void 0:r.full_name)||((s=t.author)==null?void 0:s.username)||"Unknown"]}),e.jsxs("p",{className:"text-text-secondary line-clamp-3",children:[t.content.replace(/<[^>]+>/g,"").substring(0,150),"..."]}),e.jsx("div",{className:"mt-4 text-sm text-text-secondary",children:new Date(t.created_at).toLocaleDateString()})]})]},t.id)})}),Z.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-medium text-text-primary",children:"No posts found"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:i?"No posts match your search criteria":h==="all"?"There are no posts in the system":`No ${h} posts found`})]})]}):e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",placeholder:"Search comments...",className:"px-4 py-2 rounded-lg border border-border focus:outline-none focus:ring-2 focus:ring-primary",value:i,onChange:t=>R(t.target.value)}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>O("all"),className:`px-4 py-2 rounded-l-lg ${q==="all"?"bg-primary text-white":"bg-background-secondary hover:bg-background-hover"}`,children:"All"}),e.jsx("button",{onClick:()=>O("reported"),className:`px-4 py-2 rounded-r-lg ${q==="reported"?"bg-primary text-white":"bg-background-secondary hover:bg-background-hover"}`,children:"Reported"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:T.filter(t=>{var r,s;return t.content.toLowerCase().includes(i.toLowerCase())||((r=t.user.username)==null?void 0:r.toLowerCase().includes(i.toLowerCase()))||((s=t.user.full_name)==null?void 0:s.toLowerCase().includes(i.toLowerCase()))}).map(t=>e.jsxs("div",{className:"bg-background-secondary rounded-lg p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[t.user.avatar_url?e.jsx("img",{src:t.user.avatar_url,alt:t.user.username||"User",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/30 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:(t.user.username||"U").substring(0,2).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.user.username||t.user.full_name}),e.jsx("div",{className:"text-sm text-text-secondary",children:new Date(t.created_at).toLocaleDateString()})]})]}),e.jsx("button",{onClick:()=>{H(t),$(!0)},className:"text-text-secondary hover:text-red-500 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("p",{className:"text-text-primary whitespace-pre-wrap",children:t.content})]},t.id))}),T.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-medium text-text-primary",children:"No comments found"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:i?"No comments match your search criteria":q==="reported"?"No reported comments found":"There are no comments in the system"})]})]}),Q&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-background-primary rounded-lg p-6 max-w-sm w-full shadow-xl",children:[e.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4",children:"Delete Post"}),e.jsxs("p",{className:"text-text-secondary mb-6",children:['Are you sure you want to delete "',u.title,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:()=>S(!1),className:"px-4 py-2 text-text-primary hover:text-text-primary",children:"Cancel"}),e.jsx("button",{onClick:ue,className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete"})]})]})}),X&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-background-primary rounded-lg p-6 max-w-sm w-full shadow-xl",children:[e.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4",children:"Delete User Account"}),e.jsxs("p",{className:"text-text-secondary mb-6",children:['Are you sure you want to delete the account for "',a.username||a.email,'"? This will permanently remove their account and all their posts. This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:()=>M(!1),className:"px-4 py-2 text-text-primary hover:text-text-primary",children:"Cancel"}),e.jsx("button",{onClick:de,className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete User"})]})]})}),Y&&L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-background-primary rounded-lg p-6 max-w-sm w-full shadow-xl",children:[e.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4",children:"Delete Comment"}),e.jsx("p",{className:"text-text-secondary mb-6",children:"Are you sure you want to delete this comment? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:()=>$(!1),className:"px-4 py-2 text-text-primary hover:text-text-primary",children:"Cancel"}),e.jsx("button",{onClick:he,className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete"})]})]})})]})}export{Se as default};
