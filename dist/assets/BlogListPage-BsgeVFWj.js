import{j as e,A as E,m as P}from"./ui-DVmofzuT.js";import{r as l,L as k}from"./vendor-Bh044VG2.js";import{u as $,s as L,L as M}from"./index-BMdVCYPh.js";import{g as N,c as R,a as A}from"./categoryService-BgLIrQg1.js";import{p as B}from"./purify.es-DhD2mIk-.js";import"./three-DA2LJXh8.js";const I=({title:h,excerpt:c,author:f,date:s,imageUrl:a,children:d})=>{const[i,x]=l.useState(!1),[r,p]=l.useState({x:0,y:0}),u=l.useRef(null),b=l.useRef(null);return l.useEffect(()=>{if(i&&u.current&&b.current){const n=u.current.getBoundingClientRect(),g=b.current.getBoundingClientRect();let o=n.x+n.width/2-g.width/2,v=n.y-g.height-10;o<10&&(o=10),o+g.width>window.innerWidth-10&&(o=window.innerWidth-g.width-10),v<10&&(v=n.bottom+10),p({x:o,y:v})}},[i]),e.jsxs("div",{className:"relative inline-block",ref:u,onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:[d,e.jsx(E,{children:i&&e.jsxs(P.div,{ref:b,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},style:{position:"fixed",left:r.x,top:r.y,zIndex:50},className:"w-72 rounded-xl overflow-hidden backdrop-blur-lg bg-black/70 border border-white/10 shadow-xl",children:[a&&e.jsx("div",{className:"w-full h-32 overflow-hidden",children:e.jsx("img",{src:a,alt:h,className:"w-full h-full object-cover transition-transform duration-500 hover:scale-110"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-white font-medium mb-1",children:h}),e.jsx("p",{className:"text-white/80 text-sm line-clamp-2 mb-2",children:c}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-white/60",children:[e.jsx("span",{children:f}),e.jsx("span",{children:s})]})]})]})})]})},z=({id:h,title:c,excerpt:f,author:s,date:a,imageUrl:d,categories:i=[],isDraft:x=!1,isOwner:r=!1,content:p})=>{const[u,b]=l.useState(!1),n=new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),g=()=>!s||!s.name?"??":s.name.substring(0,2).toUpperCase();return e.jsx(I,{title:c,excerpt:f,author:(s==null?void 0:s.name)||"Unknown",date:n,imageUrl:d,children:e.jsx("div",{className:`bg-black/40 backdrop-blur-md border border-white/10 rounded-xl overflow-hidden shadow-lg 
                  transition-all duration-500 h-full`,onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),children:e.jsxs(k,{to:`/blog/${h}`,className:"block h-full",children:[d&&e.jsxs("div",{className:"relative overflow-hidden h-48",children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:`url(${d})`}}),e.jsx("div",{className:`absolute inset-0 bg-gradient-to-b from-transparent to-black/80 
                          transition-opacity duration-500 ${u?"opacity-50":"opacity-70"}`}),i.length>0&&e.jsx("div",{className:"absolute top-3 right-3 flex flex-wrap gap-2 justify-end",children:i.map(o=>e.jsx("span",{className:"px-2 py-1 text-xs rounded-md text-white backdrop-blur-sm",style:{backgroundColor:N(o)},children:o},o))}),x&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:"px-2 py-1 text-xs rounded-md bg-yellow-500/80 text-white backdrop-blur-sm",children:"Draft"})})]}),e.jsxs("div",{className:"p-5",children:[e.jsx("h3",{className:`text-white text-xl font-bold mb-2 transition-all duration-500 ${u?"text-accent":""}`,children:c}),e.jsx("p",{className:"text-white/70 text-sm line-clamp-2 mb-4",children:f}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[s!=null&&s.avatar?e.jsx("img",{src:s.avatar,alt:s.name||"Author",className:"w-8 h-8 rounded-full object-cover border border-white/20"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent/30 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:g()})}),e.jsx("span",{className:"text-white/60 text-xs",children:(s==null?void 0:s.name)||"Unknown"})]}),e.jsx("span",{className:"text-white/60 text-xs",children:n})]}),!d&&i.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:i.map(o=>e.jsx("span",{className:"px-2 py-1 text-xs rounded-md text-white",style:{backgroundColor:N(o)},children:o},o))})]})]})})})},O=({categories:h,selectedCategory:c,onChange:f,placeholder:s="All Categories"})=>{const[a,d]=l.useState(!1),i=l.useRef(null);l.useEffect(()=>{const r=p=>{i.current&&!i.current.contains(p.target)&&d(!1)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]);const x=r=>{f(r),d(!1)};return e.jsxs("div",{className:"relative w-full",ref:i,children:[e.jsxs("button",{type:"button",className:"flex items-center justify-between w-full p-2 rounded-md bg-[#1f1f1f] border border-white/20 text-white focus:border-[#e50914] focus:ring-1 focus:ring-[#e50914]",onClick:()=>d(!a),children:[e.jsx("div",{className:"flex items-center",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:N(c)}}),e.jsx("span",{children:c})]}):e.jsx("span",{className:"text-gray-400",children:s})}),e.jsx("svg",{className:`w-5 h-5 transition-transform duration-200 ${a?"transform rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-[#1f1f1f] border border-white/20 rounded-md shadow-lg max-h-60 overflow-auto",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{className:`flex items-center w-full px-4 py-2 text-left hover:bg-[#e50914]/10 ${c?"":"bg-[#e50914]/20"}`,onClick:()=>x(""),children:e.jsx("span",{children:s})}),h.map(r=>e.jsxs("button",{className:`flex items-center w-full px-4 py-2 text-left hover:bg-[#e50914]/10 ${c===r?"bg-[#e50914]/20":""}`,onClick:()=>x(r),children:[e.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:N(r)}}),e.jsx("span",{children:r})]},r))]})})]})};function J(){const[h,c]=l.useState([]),[f,s]=l.useState(!0),[a,d]=l.useState("all"),[i,x]=l.useState(""),[r,p]=l.useState(""),[u,b]=l.useState(!1),{user:n}=$(),g=A();l.useEffect(()=>{o()},[n,a]);async function o(){s(!0);try{let t=L.from("posts").select("*").order("created_at",{ascending:!1});n?t=t.or(`published.eq.true,and(author_id.eq.${n.id},published.eq.false)`):t=t.eq("published",!0);const{data:w,error:j}=await t;if(j)throw j;const F=[...new Set((w==null?void 0:w.map(m=>m.author_id))||[])],{data:y,error:S}=await L.from("profiles").select("*").in("id",F);if(S)throw S;const _=new Map(y==null?void 0:y.map(m=>[m.id,m])),D=(w||[]).filter(m=>m.id).map(m=>(m.category_ml||(m.category_ml=R(m.content)),{...m,author:_.get(m.author_id)||{username:"Unknown",full_name:"Unknown User",avatar_url:""}}))||[];c(D)}catch(t){console.error("Error fetching posts:",t)}finally{s(!1)}}function v(t){const j=B.sanitize(t).replace(/<[^>]+>/g,"").trim();return j.length>150?j.substring(0,150)+"...":j}const C=h.filter(t=>!(a==="published"&&!t.published||a==="drafts"&&(t.published||t.author_id!==(n==null?void 0:n.id))||i&&t.category_ml!==i||r&&new Date(t.created_at).toISOString().split("T")[0]!==r));return f?e.jsx("div",{className:"min-h-[calc(100vh-4rem)] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(M,{size:"lg"}),e.jsx("p",{className:"mt-4 text-text-secondary animate-pulse",children:"Loading posts..."})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold mb-6 text-white",children:"Blog Posts"}),n&&e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("button",{onClick:()=>d("all"),className:`px-4 py-2 rounded-lg transition-all duration-200 ${a==="all"?"bg-[#e50914] text-white font-medium":"bg-white/10 text-white hover:bg-[#e50914]/80 hover:text-white font-medium border border-[#e50914]/20"}`,children:"All Posts"}),e.jsx("button",{onClick:()=>d("published"),className:`px-4 py-2 rounded-lg transition-all duration-200 ${a==="published"?"bg-[#e50914] text-white font-medium":"bg-white/10 text-white hover:bg-[#e50914]/80 hover:text-white font-medium border border-[#e50914]/20"}`,children:"Published"}),e.jsx("button",{onClick:()=>d("drafts"),className:`px-4 py-2 rounded-lg transition-all duration-200 ${a==="drafts"?"bg-[#e50914] text-white font-medium":"bg-white/10 text-white hover:bg-[#e50914]/80 hover:text-white font-medium border border-[#e50914]/20"}`,children:"My Drafts"})]}),e.jsxs("div",{className:"w-full max-w-3xl mb-6",children:[e.jsxs("button",{onClick:()=>b(!u),className:"flex items-center text-[#e50914] hover:text-[#e50914]/80 transition-all duration-200",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})}),u?"Hide Filters":"Show Filters"]}),u&&e.jsxs("div",{className:"mt-4 p-4 bg-[#141414] border border-white/20 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"categoryFilter",className:"block text-sm font-medium text-white mb-1",children:"Filter by Category"}),e.jsx(O,{categories:g,selectedCategory:i,onChange:x,placeholder:"All Categories"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dateFilter",className:"block text-sm font-medium text-white mb-1",children:"Filter by Date"}),e.jsx("input",{id:"dateFilter",type:"date",value:r,onChange:t=>p(t.target.value),className:"w-full p-2 rounded-md bg-[#1f1f1f] border border-white/20 text-white focus:border-[#e50914] focus:ring-1 focus:ring-[#e50914]"})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>{x(""),p("")},className:"px-3 py-1 text-sm bg-[#e50914]/10 text-[#e50914] rounded-md hover:bg-[#e50914]/20 transition-all duration-200 border border-[#e50914]/30",children:"Clear Filters"})})]})]}),e.jsxs(k,{to:"/dashboard/new",className:"inline-flex items-center px-4 py-2 bg-[#e50914] text-white rounded-lg hover:bg-opacity-80 transition-all duration-200",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create New Post"]})]}),C.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-text-secondary text-lg",children:"No posts found matching your criteria."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:C.map(t=>e.jsx(k,{to:`/blog/${t.id}`,className:"transition-transform duration-200",children:e.jsx(z,{id:t.id,title:t.title,excerpt:v(t.content),imageUrl:t.featured_image||"",author:{name:t.author.full_name,avatar:t.author.avatar_url},date:new Date(t.created_at).toLocaleDateString(),categories:t.category_ml?[t.category_ml]:[],isDraft:!t.published,isOwner:t.author_id===(n==null?void 0:n.id)})},t.id))})]})}export{J as default};
