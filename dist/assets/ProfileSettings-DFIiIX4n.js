import{j as e}from"./ui-DVmofzuT.js";import{r as o}from"./vendor-Bh044VG2.js";import{u as E,s as x}from"./index-BMdVCYPh.js";import{g as U}from"./cloudinaryConfig-Dce98kpw.js";import"./three-DA2LJXh8.js";function I(){const{user:t}=E(),[p,m]=o.useState(!1),[u,i]=o.useState(null),[s,h]=o.useState({id:(t==null?void 0:t.id)||"",username:(t==null?void 0:t.username)||"",full_name:(t==null?void 0:t.full_name)||"",avatar_url:(t==null?void 0:t.avatar_url)||""}),[g,w]=o.useState(null),[y,b]=o.useState(s.avatar_url||null);o.useEffect(()=>{t&&j()},[t]);async function j(){try{m(!0);const{data:r,error:a}=await x.from("profiles").select("*").eq("id",t==null?void 0:t.id).single();if(a)throw a;r&&(h(r),b(r.avatar_url||null))}catch(r){console.error("Error loading profile:",r),i({type:"error",text:"Error loading profile"})}finally{m(!1)}}const v=r=>{const{name:a,value:n}=r.target;h(l=>({...l,[a]:n}))},N=r=>{if(r.target.files&&r.target.files[0]){const a=r.target.files[0];if(a.size>2*1024*1024){i({type:"error",text:"Image size should be less than 2MB"});return}w(a),b(URL.createObjectURL(a))}};async function _(r,a){var n;try{const l=String(Math.round(new Date().getTime()/1e3)),d=await U(l),c=new FormData;c.append("file",r),c.append("timestamp",l),c.append("api_key","752847587235562"),c.append("signature",d);const f=await fetch(`https://api.cloudinary.com/v1_1/dckv73izl/${a}/upload`,{method:"POST",body:c});if(!f.ok){const P=await f.json();throw new Error(`Cloudinary upload failed: ${((n=P.error)==null?void 0:n.message)||"Unknown error"}`)}return(await f.json()).secure_url}catch(l){throw console.error("Error uploading to Cloudinary:",l),l}}const S=async()=>{if(!g)return s.avatar_url||null;try{return await _(g,"image")}catch(r){throw console.error("Error uploading avatar:",r),r}},k=async r=>{r.preventDefault();try{if(m(!0),i(null),!s.username.trim()||!s.full_name.trim()){i({type:"error",text:"Username and full name are required"});return}const{data:a,error:n}=await x.from("profiles").select("id").eq("username",s.username).neq("id",t==null?void 0:t.id).single();if(n&&n.code!=="PGRST116")throw n;if(a){i({type:"error",text:"Username is already taken"});return}const l=await S(),{error:d}=await x.from("profiles").update({username:s.username,full_name:s.full_name,avatar_url:l||s.avatar_url,updated_at:new Date().toISOString()}).eq("id",t==null?void 0:t.id);if(d)throw d;i({type:"success",text:"Profile updated successfully"})}catch(a){console.error("Error updating profile:",a),i({type:"error",text:"Error updating profile"})}finally{m(!1)}};return t?e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-primary mb-8",children:"Profile Settings"}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Profile Picture"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden bg-accent/10",children:y?e.jsx("img",{src:y,alt:"Profile preview",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-accent text-2xl",children:s.full_name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"avatar",className:"block text-sm font-medium text-text-primary",children:"Upload Avatar"}),e.jsx("input",{type:"file",id:"avatar",accept:"image/*",onChange:N,className:`block w-full text-sm text-text-primary
                         file:mr-4 file:py-2 file:px-4
                         file:rounded-full file:border-0
                         file:text-sm file:font-semibold
                         file:bg-accent file:text-white
                         hover:file:bg-accent/90`}),e.jsx("p",{className:"mt-1 text-sm text-text-primary/60",children:"JPG, PNG or GIF (max. 2MB)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-text-primary",children:"Username"}),e.jsx("input",{type:"text",id:"username",name:"username",value:s.username,onChange:v,className:`mt-1 block w-full rounded-md border border-text-primary/10 
                     bg-bg-secondary text-text-primary shadow-sm
                     focus:border-accent focus:ring-accent sm:text-sm
                     px-4 py-2`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"full_name",className:"block text-sm font-medium text-text-primary",children:"Full Name"}),e.jsx("input",{type:"text",id:"full_name",name:"full_name",value:s.full_name,onChange:v,className:`mt-1 block w-full rounded-md border border-text-primary/10 
                     bg-bg-secondary text-text-primary shadow-sm
                     focus:border-accent focus:ring-accent sm:text-sm
                     px-4 py-2`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Email"}),e.jsx("input",{type:"email",value:t.email,"aria-label":"Email",disabled:!0,className:`mt-1 block w-full rounded-md border border-text-primary/10
                     bg-bg-secondary/50 text-text-primary/70 shadow-sm
                     cursor-not-allowed sm:text-sm px-4 py-2`})]}),u&&e.jsx("div",{className:`p-4 rounded-md ${u.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:u.text}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:p,className:`w-full flex justify-center py-2 px-4 border border-transparent 
                     rounded-md shadow-sm text-sm font-medium text-bg-primary bg-accent 
                     hover:bg-accent/90 focus:outline-none focus:ring-2 
                     focus:ring-offset-2 focus:ring-accent disabled:opacity-50
                     disabled:cursor-not-allowed dark:text-bg-primary`,children:p?"Saving...":"Save Changes"})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("p",{className:"text-text-primary",children:"Please sign in to access this page."})})}export{I as default};
