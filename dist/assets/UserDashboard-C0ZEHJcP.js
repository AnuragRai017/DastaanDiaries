import{j as e}from"./ui-DVmofzuT.js";import{r as l}from"./vendor-Bh044VG2.js";import{E as se}from"./editor-Fw73Cy45.js";import{u as le,s as y,L as ie}from"./index-BMdVCYPh.js";import{g as oe}from"./cloudinaryConfig-Dce98kpw.js";import{g as R,a as ne,c as $}from"./categoryService-BgLIrQg1.js";import"./three-DA2LJXh8.js";function ye(){const[D,L]=l.useState([]),[q,v]=l.useState(!1),[k,f]=l.useState(""),[d,b]=l.useState(""),[_,m]=l.useState(""),[j,g]=l.useState(null),[U,x]=l.useState(null),[w,h]=l.useState(null),[I,c]=l.useState(""),[S,A]=l.useState(!1),[i,N]=l.useState(null),[M,C]=l.useState(!1),[G,E]=l.useState(!1),[p,P]=l.useState("all"),{user:o}=le(),O=ne();l.useEffect(()=>{o&&B()},[o]);async function B(){try{const{data:t,error:r}=await y.from("posts").select("*").eq("author_id",o==null?void 0:o.id).order("created_at",{ascending:!1});if(r)throw r;const{data:a,error:s}=await y.from("profiles").select("*").eq("id",o==null?void 0:o.id).single();if(s&&s.code!=="PGRST116")throw s;const n=(t==null?void 0:t.map(u=>({...u,author:a||{username:"Unknown",full_name:"Unknown User"}})))||[];L(n)}catch(t){console.error("Error fetching posts:",t)}}const W=D.filter(t=>{switch(p){case"published":return t.published;case"draft":return!t.published;default:return!0}}),V=t=>{var a;const r=(a=t.target.files)==null?void 0:a[0];if(r){x(r);const s=new FileReader;s.onloadend=()=>{c(s.result)},s.readAsDataURL(r)}},J=t=>{var a;t.preventDefault();const r=(a=t.dataTransfer.files)==null?void 0:a[0];if(r&&r.type.startsWith("image/")){x(r);const s=new FileReader;s.onloadend=()=>{c(s.result)},s.readAsDataURL(r)}},K=t=>{var a;t.preventDefault();const r=(a=t.dataTransfer.files)==null?void 0:a[0];r&&r.type.startsWith("audio/")&&h(r)},T=t=>{t.preventDefault(),t.currentTarget.classList.add("border-primary-500","bg-primary-50","dark:bg-primary-900/10")},z=t=>{t.preventDefault(),t.currentTarget.classList.remove("border-primary-500","bg-primary-50","dark:bg-primary-900/10")};async function H(t,r){var a;try{const s=String(Math.round(new Date().getTime()/1e3)),n=await oe(s),u=new FormData;u.append("file",t),u.append("timestamp",s),u.append("api_key","752847587235562"),u.append("signature",n);const F=await fetch(`https://api.cloudinary.com/v1_1/dckv73izl/${r}/upload`,{method:"POST",body:u});if(!F.ok){const ae=await F.json();throw new Error(`Cloudinary upload failed: ${((a=ae.error)==null?void 0:a.message)||"Unknown error"}`)}return(await F.json()).secure_url}catch(s){throw console.error("Error uploading to Cloudinary:",s),s}}const Q=t=>{N(t),f(t.title),b(t.content),m(t.category||""),c(t.featured_image||""),C(!0),v(!0)},X=async t=>{N(t),E(!0)},Y=async()=>{if(i)try{const{error:t}=await y.from("posts").delete().eq("id",i.id);if(t)throw t;L(D.filter(r=>r.id!==i.id)),E(!1),N(null)}catch(t){console.error("Error deleting post:",t)}},Z=()=>{if(d){const t=$(d);g(t)}},ee=()=>{j&&(m(j),g(null))};async function te(t){if(t.preventDefault(),!(!k||!d))try{A(!0);let r="",a="";U&&(r=await H(U,"image")),w&&(a=await H(w,"auto"));const s=_||$(d);if(M){const{error:n}=await y.from("posts").update({title:k,content:d,featured_image:r||(i==null?void 0:i.featured_image),audio_url:a||(i==null?void 0:i.audio_url),category:s}).eq("id",i==null?void 0:i.id);if(n)throw n}else{const{error:n}=await y.from("posts").insert({title:k,content:d,author_id:o==null?void 0:o.id,featured_image:r,audio_url:a,published:!1,category:s});if(n)throw n}f(""),b(""),m(""),g(null),x(null),h(null),c(""),v(!1),C(!1),B()}catch(r){console.error("Error creating post:",r)}finally{A(!1)}}async function re(t){try{const{error:r}=await y.from("posts").update({published:!t.published}).eq("id",t.id);if(r)throw r;L(D.map(a=>a.id===t.id?{...a,published:!a.published}:a))}catch(r){console.error("Error toggling publish status:",r)}}return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"My Blog Posts"}),e.jsx("button",{onClick:()=>{v(!0),C(!1),f(""),b(""),m(""),g(null),c(""),x(null),h(null)},className:"bg-primary-500 text-white px-4 py-2 rounded-lg hover:bg-primary-600 transition-colors",children:"Create New Post"})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("button",{onClick:()=>P("all"),className:`px-4 py-2 rounded-lg ${p==="all"?"bg-primary-500 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:"All Posts"}),e.jsx("button",{onClick:()=>P("published"),className:`px-4 py-2 rounded-lg ${p==="published"?"bg-primary-500 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:"Published"}),e.jsx("button",{onClick:()=>P("draft"),className:`px-4 py-2 rounded-lg ${p==="draft"?"bg-primary-500 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:"Drafts"})]}),q?e.jsxs("div",{className:"mt-8 bg-white dark:bg-gray-800 shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-6",children:M?"Edit Post":"Create New Post"}),e.jsxs("form",{onSubmit:te,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Title"}),e.jsx("input",{type:"text",id:"title",value:k,onChange:t=>f(t.target.value),className:"input mt-1 w-full",placeholder:"Enter post title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Content"}),e.jsx(se,{apiKey:"wqdsjyw1ljs9pgmvqrz0yra3xquexocn79m345lw5yv0uk5x",init:{height:400,menubar:!1,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","code","help","wordcount"],toolbar:"undo redo | blocks | bold italic forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family: -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif; font-size: 14px; }"},value:d,onEditorChange:t=>{b(t),g(null)}})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category"}),e.jsx("button",{type:"button",onClick:Z,className:"text-sm text-primary-600 hover:text-primary-500",children:"Suggest category"})]}),j&&e.jsxs("div",{className:"mb-2 p-2 bg-primary-50 dark:bg-primary-900/20 rounded-md flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Suggested category:"}),e.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-md text-white ${R(j)}`,children:j})]}),e.jsx("button",{type:"button",onClick:ee,className:"text-xs bg-primary-500 text-white px-2 py-1 rounded-md hover:bg-primary-600",children:"Apply"})]}),e.jsxs("select",{id:"category",value:_,onChange:t=>m(t.target.value),className:"input mt-1 w-full",children:[e.jsx("option",{value:"",children:"Select a category"}),O.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"If no category is selected, one will be automatically assigned based on content."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Featured Image"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-700 border-dashed rounded-lg transition-colors duration-200",onDrop:J,onDragOver:T,onDragLeave:z,children:e.jsx("div",{className:"space-y-1 text-center",children:I?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:I,alt:"Preview",className:"mx-auto h-32 w-auto rounded"}),e.jsx("button",{type:"button",title:"Remove preview image",onClick:()=>{c(""),x(null)},className:"absolute top-0 right-0 -mt-2 -mr-2 bg-red-100 text-red-600 rounded-full p-1 hover:bg-red-200 transition-colors duration-200",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md font-medium text-primary-600 hover:text-primary-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary-500",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:"image/*",onChange:V})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF up to 10MB"})]})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Audio File (optional)"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-700 border-dashed rounded-lg transition-colors duration-200",onDrop:K,onDragOver:T,onDragLeave:z,children:e.jsx("div",{className:"space-y-1 text-center",children:w?e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M12 1a3 3 0 00-3 3v32a3 3 0 003 3h28a3 3 0 003-3V4a3 3 0 00-3-3H12zm15 33a1 1 0 01-2 0v-6H8v6a1 1 0 01-2 0v-8a3 3 0 013-3h13a3 3 0 013 3v8a1 1 0 01-2 0z",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:w.name}),e.jsx("button",{title:"Remove audio file",type:"button",onClick:()=>{h(null)},className:"absolute top-0 right-0 -mt-2 -mr-2 bg-red-100 text-red-600 rounded-full p-1 hover:bg-red-200 transition-colors duration-200",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M12 1a3 3 0 00-3 3v32a3 3 0 003 3h28a3 3 0 003-3V4a3 3 0 00-3-3H12zm15 33a1 1 0 01-2 0v-6H8v6a1 1 0 01-2 0v-8a3 3 0 013-3h13a3 3 0 013 3v8a1 1 0 01-2 0z",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"audio-file-upload",className:"relative cursor-pointer rounded-md font-medium text-primary-600 hover:text-primary-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary-500",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"audio-file-upload",name:"audio-file-upload",type:"file",className:"sr-only",accept:"audio/*",onChange:t=>{var r;return h(((r=t.target.files)==null?void 0:r[0])||null)}})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"MP3, WAV up to 10MB"})]})})})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{v(!1),C(!1),N(null),f(""),b(""),m(""),g(null),x(null),h(null),c("")},className:"btn btn-secondary",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"btn btn-primary",disabled:S,children:[S?e.jsx(ie,{size:"sm",className:"mr-2"}):null,S?"Creating...":M?"Update Post":"Create Post"]})]})]})]}):W.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:W.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[t.featured_image&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.featured_image,alt:t.title,className:"w-full h-48 object-cover"}),t.category&&e.jsx("span",{className:`absolute top-2 right-2 px-2 py-1 text-xs rounded-md text-white ${R(t.category)}`,children:t.category})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:t.title}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:`px-2 py-1 rounded text-sm ${t.published?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100"}`,children:t.published?"Published":"Draft"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>Q(t),className:"text-gray-600 dark:text-gray-300 hover:text-primary-500",title:"Edit",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>re(t),className:"text-gray-600 dark:text-gray-300 hover:text-primary-500",title:t.published?"Unpublish":"Publish",children:t.published?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})}):e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 15l7-7 7 7"})})}),e.jsx("button",{onClick:()=>X(t),className:"text-gray-600 dark:text-gray-300 hover:text-red-500",title:"Delete",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 line-clamp-3",children:[t.content.replace(/<[^>]+>/g,"").substring(0,150),"..."]}),e.jsx("div",{className:"mt-4 text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString()})]})]},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"No posts found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:p==="all"?"Get started by creating your first post":`No ${p} posts found`})]}),G&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Delete Post"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:['Are you sure you want to delete "',i.title,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:()=>E(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"Cancel"}),e.jsx("button",{onClick:Y,className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete"})]})]})})]})}export{ye as default};
